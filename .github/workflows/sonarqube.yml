on:
  workflow_call:
  
jobs:

  analyse-code:

    runs-on: ubuntu-latest

    steps:

      ## Front 

      # - uses: actions/checkout@v4
      #   with:
      #     fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      
      # - name: Analyze frontend
      #   uses: SonarSource/sonarcloud-github-action@master
      #   with: 
      #     projectBaseDir: ./front
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any
      #     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      # - uses: actions/checkout@v4
      #   with:
      #       fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis

      ## Back

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          java-version: 11
          distribution: 'temurin'
        
      # - name: Cache SonarQube packages
      #   uses: actions/cache@v4
      #   env: 
      #     working-directory: ./back
      #   with:
      #     #working-directory: ./back
      #     path: ~/.sonar/cache
      #     key: ${{ runner.os }}-sonar
      #     restore-keys: ${{ runner.os }}-sonar
        
      # - name: Cache Maven packages
      #   uses: actions/cache@v4
      #   env: 
      #     working-directory: ./back
      #   with:
      #     #working-directory: ./back
      #     path: ~/.m2
      #     key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
      #     restore-keys: ${{ runner.os }}-m2
      
      - name: Analyze backend
        uses: sonarsource/sonarcloud-github-action@v3.1.0 # Ex: v2.1.0, See the latest version at https://github.com/marketplace/actions/sonarcloud-scan
        with: 
          projectBaseDir: ~/back
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      # - name: Analyze backend
      #   env:
      #     projectBaseDir: ~/back
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      #   #working-directory: back
      #   run: mvn -B verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar -Dsonar.projectKey=Solau92_DevFS-Projet-10-Gerez-un-projet-collaboratif-en-integrant-une-demarche-CI-CD


      